<!--begin:: subheader-->
<div class="m-subheader">
    <div class="d-flex align-items-center">
        <div class="mr-auto">
            <app-breadcrumb></app-breadcrumb>
        </div>
        <div class="c-button-actions">
            <button type="button" class="btn btn-success m-btn--square m-btn--icon m-btn--uppercase m--margin-right-10"
                (click)="onOpePLPrint()">
                <span>
                    <i class="la la-print"></i>
                    <span>
                        P/L Sheet
                    </span>
                </span>
            </button>
        </div>
        <div class="c-button-actions">
            <button type="button" class="btn btn-danger m-btn--square m-btn--icon m-btn--uppercase"
                (click)="confirmDelete()">
                <span>
                    <i class="la la-trash"></i>
                    <span>
                        delete
                    </span>
                </span>
            </button>
        </div>
        <button type="button" class="btn m-btn--square m-btn--icon m-btn--uppercase" (click)="confirmCancelJob()">
            <span>
                <i class="la la-ban"></i>
                <span>
                    cancel
                </span>
            </span>
        </button>
    </div>
</div>
<!--end:: subheader-->

<!--begin:: m-content -->
<div class="m-content" *ngIf="opsTransaction">
    <div class="row">
        <div class="col-12">
            <tabset type="tabs">
                <tab heading="Job detail" (selectTab)="selectTab($event,'job-edit')">
                    <div *ngIf="tab === 'job-edit'">
                        <!--begin::Form-->
                        <form novalidate #addOpsForm="ngForm" name="addOpsForm" (ngSubmit)="addOpsForm.form.valid">

                            <div class="m-form m-form--state">
                                <!--begin::m-portlet -->
                                <div class="m-portlet">
                                    <div class="alert-block__heading">
                                        <h3 class="alert-block__title">Job Information</h3>
                                    </div>
                                    <div class="m-portlet__body" id="edit-ops-job-form">
                                        <!--begin:: form-actions-->
                                        <div class="form-actions m--align-right">
                                            <button type=""
                                                class="btn btn-brand m-btn--square m-btn--icon m-btn--uppercase"
                                                (click)="saveShipment(addOpsForm)">
                                                <span>
                                                    <i class="la la la-save"></i>
                                                    <span>
                                                        save detail
                                                    </span>
                                                </span>
                                            </button>
                                            <!-- <button type="button"
                                                class="btn btn-cancel m-btn--square m-btn--icon m-btn--uppercase"
                                                data-toggle="modal" data-target="#cancel-create-ops-job-modal">
                                                <span>
                                                    <i class="la la-ban"></i>
                                                    <span>
                                                        cancel
                                                    </span>
                                                </span>
                                            </button> -->
                                            <button type="button"
                                                class="btn btn-cancel m-btn--square m-btn--icon m-btn--uppercase"
                                                (click)="cancelCreatJob()">
                                                <span>
                                                    <i class="la la-ban"></i>
                                                    <span>
                                                        cancel
                                                    </span>
                                                </span>
                                            </button>
                                        </div>
                                        <!--end:: form-actions-->
                                        <!--begin:: General Information -->
                                        <div class="div-inside bg-secondary m--margin-bottom-15">
                                            <h3 class="c-block-title">General Information</h3>
                                            <hr>
                                            <div class="row">
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label class="form-control-label" for="">
                                                            Job ID
                                                            <!-- <span class="m--font-danger">(*)</span> -->
                                                        </label>
                                                        <input type="text" required
                                                            class="form-control m-input m-input--square"
                                                            placeholder="Enter text" name="jobNo" disabled=true
                                                            [(ngModel)]="opsTransaction.jobNo" #jobNo="ngModel">
                                                        <!-- <div class="form-control-feedback" style="display: none">
                                                    HBL No is required!
                                                </div> -->
                                                    </div>
                                                </div>
                                                <!-- <div class="col-lg-4">
                                            <div class="form-group">
                                                <label class="form-control-label" for="">
                                                    MBL No
                                                </label>
                                                <input type="text" required class="form-control m-input m-input--square"
                                                    placeholder="Enter text" name="">
                                            </div>
                                        </div> -->
                                                <div class="col-lg-4">
                                                    <div class="form-group"
                                                        [ngClass]="{ 'has-danger': addOpsForm.submitted && serviceDate == null }">
                                                        <label class="form-control-label" for="">
                                                            Service Date <span class="m--font-danger">(*)</span>
                                                        </label>
                                                        <div class="m-input-icon m-input-icon--right down">
                                                            <input type="text"
                                                                class="form-control m-input m-input--square"
                                                                ngxDaterangepickerMd [autoApply]="true"
                                                                [locale]="{applyLabel: 'ok', format: 'DD/MM/YYYY'}"
                                                                [(ngModel)]="serviceDate" [singleDatePicker]="true"
                                                                name="serviceDate" readonly />
                                                            <span class="m-input-icon__icon m-input-icon__icon--right">
                                                                <span>
                                                                    <i class="la la-calendar"></i>
                                                                </span>
                                                            </span>
                                                        </div>
                                                        <div class="form-control-feedback"
                                                            *ngIf="addOpsForm.submitted && serviceDate == null">
                                                            Service Date is required!
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group"
                                                        [ngClass]="{ 'has-danger': addOpsForm.submitted && finishDate != null && this.finishDate.startDate != null && this.serviceDate.startDate != null && (this.finishDate.startDate < this.serviceDate.startDate)}">
                                                        <label class="form-control-label" for="">
                                                            Finish Date
                                                        </label>
                                                        <div class="m-input-icon m-input-icon--right down">
                                                            <input type="text"
                                                                class="form-control m-input m-input--square"
                                                                ngxDaterangepickerMd [autoApply]="true"
                                                                [locale]="{applyLabel: 'ok', format: 'DD/MM/YYYY'}"
                                                                [(ngModel)]="finishDate" [singleDatePicker]="true"
                                                                name="finishDate" readonly />
                                                            <span class="m-input-icon__icon m-input-icon__icon--right">
                                                                <span>
                                                                    <i class="la la-calendar"></i>
                                                                </span>
                                                            </span>
                                                        </div>
                                                        <div class="form-control-feedback"
                                                            *ngIf="addOpsForm.submitted && this.finishDate.startDate != null && this.serviceDate.startDate != null && (this.finishDate.startDate < this.serviceDate.startDate)">
                                                            Finish Date must more greater or equal Service Date
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-4">
                                                    <div class="form-group"
                                                        [ngClass]="{'m-form__group has-danger':addOpsForm.submitted && opsTransaction.productService == null}">
                                                        <label class="form-control-label" for="">
                                                            Product Service <span class="m--font-danger">(*)</span>
                                                        </label>
                                                        <ng-select [allowClear]="true" [items]="productServices"
                                                            (data)="refreshValue($event)"
                                                            [active]="productServiceActive"
                                                            (selected)="opsTransaction.productService = $event.id"
                                                            (removed)="opsTransaction.productService = null"
                                                            (typed)="typed($event)" placeholder="Please Select">
                                                        </ng-select>
                                                        <div class="form-control-feedback"
                                                            *ngIf="addOpsForm.submitted && opsTransaction.productService === null">
                                                            Product Service is required!
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group"
                                                        [ngClass]="{'m-form__group has-danger':addOpsForm.submitted && opsTransaction.serviceMode == null}">
                                                        <label class="form-control-label" for="">
                                                            Service Mode <span class="m--font-danger">(*)</span>
                                                        </label>
                                                        <ng-select [allowClear]="true" [items]="serviceModes"
                                                            (data)="refreshValue($event)" [active]="serviceModeActive"
                                                            (selected)="opsTransaction.serviceMode = $event.id"
                                                            (removed)="opsTransaction.serviceMode = null"
                                                            (typed)="typed($event)" placeholder="Please Select">
                                                        </ng-select>
                                                        <div class="form-control-feedback"
                                                            *ngIf="addOpsForm.submitted && opsTransaction.serviceMode === null">
                                                            Service Mode is required!
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group"
                                                        [ngClass]="{'m-form__group has-danger':addOpsForm.submitted && opsTransaction.shipmentMode == null}">
                                                        <label class="form-control-label" for="">
                                                            Shipment Mode <span class="m--font-danger">(*)</span>
                                                        </label>
                                                        <ng-select [allowClear]="true" [items]="shipmentModes"
                                                            (data)="refreshValue($event)" [active]="shipmentModeActive"
                                                            (selected)="opsTransaction.shipmentMode = $event.id"
                                                            (removed)="opsTransaction.shipmentMode = null"
                                                            (typed)="typed($event)" placeholder="Please Select">
                                                        </ng-select>
                                                        <div class="form-control-feedback"
                                                            *ngIf="addOpsForm.submitted && opsTransaction.shipmentMode === null">
                                                            Shipment Mode is required!
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-4">
                                                    <div class="form-group"
                                                        [ngClass]="{'m-form__group has-danger':addOpsForm.submitted && hwbno.invalid}">
                                                        <label class="form-control-label" for="">
                                                            HBL No <span class="m--font-danger">(*)</span>
                                                        </label>
                                                        <input type="text" required
                                                            class="form-control m-input m-input--square"
                                                            placeholder="Enter text" name="hwbno"
                                                            [(ngModel)]="opsTransaction.hwbno" #hwbno="ngModel">
                                                        <div class="form-control-feedback"
                                                            *ngIf="addOpsForm.submitted && hwbno.invalid">
                                                            HBL No is required!
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group"
                                                        [ngClass]="{'m-form__group has-danger':addOpsForm.submitted && mblno.invalid}">
                                                        <label class="form-control-label" for="">
                                                            MBL No <span class="m--font-danger">(*)</span>
                                                        </label>
                                                        <input type="text" required
                                                            class="form-control m-input m-input--square"
                                                            placeholder="Enter text" name="mblno"
                                                            [(ngModel)]="opsTransaction.mblno" #mblno="ngModel">
                                                        <div class="form-control-feedback"
                                                            *ngIf="addOpsForm.submitted && mblno.invalid">
                                                            MBL No is required!
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label class="form-control-label" for=""
                                                            [ngClass]="{'m-form__group has-danger':addOpsForm.submitted && opsTransaction.customerId == null}">
                                                            Customer <span class="m--font-danger">(*)</span>
                                                        </label>
                                                        <app-combo-grid-virtual-scroll
                                                            [currentActiveItemId]="{field:'id',value:opsTransaction.customerId}"
                                                            (itemSelected)="opsTransaction.customerId = $event.id"
                                                            [selectedDisplayFields]="['partnerNameEn']"
                                                            [dataSources]="customers"
                                                            [displayFields]="[{'field':'id','label':'Partner ID'},{'field':'shortName','label':'Name ABBR'},{'field':'partnerNameEn','label':'Name EN'},{'field':'taxCode','label':'Tax Code'}]">
                                                        </app-combo-grid-virtual-scroll>
                                                        <div class="form-control-feedback"
                                                            *ngIf="addOpsForm.submitted && opsTransaction.customerId == null">
                                                            Customer is required!
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">

                                                <div class="col-lg-4">
                                                    <div class="form-group"
                                                        [ngClass]="{'m-form__group has-danger': addOpsForm.submitted && (opsTransaction.pol === opsTransaction.pod) && (opsTransaction.pol!==null)}">
                                                        <label class="form-control-label" for="">
                                                            Port of Loading
                                                        </label>
                                                        <app-combo-grid-virtual-scroll
                                                            [currentActiveItemId]="{field:'id',value:opsTransaction.pol}"
                                                            (itemSelected)="opsTransaction.pol=$event.id"
                                                            [selectedDisplayFields]="['nameEn']" [dataSources]="ports"
                                                            [displayFields]="[{'field':'code','label':'Port Code'},{'field':'nameEn','label':'Port Name'},{'field':'countryNameEN','label':'Country'}]">
                                                        </app-combo-grid-virtual-scroll>
                                                        <div class="form-control-feedback"
                                                            *ngIf="addOpsForm.submitted && (opsTransaction.pol === opsTransaction.pod) && (opsTransaction.pol!==null)">
                                                            Port of loading is must be different with port of discharge
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group"
                                                        [ngClass]="{'m-form__group has-danger': addOpsForm.submitted && (opsTransaction.pol === opsTransaction.pod) && (opsTransaction.pol!==null)}">
                                                        <label class="form-control-label" for="">
                                                            Port of Discharge
                                                        </label>
                                                        <app-combo-grid-virtual-scroll
                                                            [currentActiveItemId]="{field:'id',value:opsTransaction.pod}"
                                                            (itemSelected)="opsTransaction.pod = $event.id"
                                                            [selectedDisplayFields]="['nameEn']" [dataSources]="ports"
                                                            [displayFields]="[{'field':'code','label':'Port Code'},{'field':'nameEn','label':'Port Name'},{'field':'countryNameEN','label':'Country'}]">
                                                        </app-combo-grid-virtual-scroll>
                                                        <div class="form-control-feedback"
                                                            *ngIf="addOpsForm.submitted && (opsTransaction.pol === opsTransaction.pod) && (opsTransaction.pol!==null)">
                                                            Port of discharge must be different with port of loading
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label class="form-control-label" for="">
                                                            Supplier
                                                        </label>
                                                        <app-combo-grid-virtual-scroll
                                                            [currentActiveItemId]="{field:'id',value:opsTransaction.supplierId}"
                                                            (itemSelected)="opsTransaction.supplierId = $event.id"
                                                            [selectedDisplayFields]="['partnerNameEn']"
                                                            [dataSources]="suppliers"
                                                            [displayFields]="[{'field':'id','label':'Partner ID'},{'field':'shortName','label':'Name ABBR'},{'field':'partnerNameEn','label':'Name EN'},{'field':'taxCode','label':'Tax Code'}]">
                                                        </app-combo-grid-virtual-scroll>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label class="form-control-label" for="">
                                                            Vessel/Flight
                                                        </label>
                                                        <input type="text" class="form-control m-input m-input--square"
                                                            placeholder="Enter text" name="flightVessel"
                                                            [(ngModel)]="opsTransaction.flightVessel"
                                                            #flightVessel="ngModel">
                                                        <!-- <div class="form-control-feedback"
                                                *ngIf="addOpsForm.submitted && flightVessel.invalid">
                                                Vessel/Flight No is required!
                                            </div> -->
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label class="form-control-label" for="">
                                                            Agent
                                                        </label>
                                                        <app-combo-grid-virtual-scroll
                                                            [currentActiveItemId]="{field:'id',value:opsTransaction.agentId}"
                                                            (itemSelected)="opsTransaction.agentId = $event.id"
                                                            [selectedDisplayFields]="['partnerNameEn']"
                                                            [dataSources]="agents"
                                                            [displayFields]="[{'field':'id','label':'Partner ID'},{'field':'shortName','label':'Name ABBR'},{'field':'partnerNameEn','label':'Name EN'},{'field':'taxCode','label':'Tax Code'}]">
                                                        </app-combo-grid-virtual-scroll>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label class="form-control-label" for="">
                                                            Warehouse
                                                        </label>
                                                        <app-combo-grid-virtual-scroll
                                                            [currentActiveItemId]="{field:'id',value:opsTransaction.warehouseId}"
                                                            (itemSelected)="opsTransaction.warehouseId = $event.id"
                                                            [selectedDisplayFields]="['nameEn']" [dataSources]="ports"
                                                            [displayFields]="[{'field':'code','label':'Port Code'},{'field':'nameEn','label':'Port Name'},{'field':'countryNameEN','label':'Country'}]">
                                                        </app-combo-grid-virtual-scroll>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label class="form-control-label" for="">
                                                            Invoice No
                                                        </label>
                                                        <input type="text" class="form-control m-input m-input--square"
                                                            name="invoiceNo" placeholder="Enter text"
                                                            [(ngModel)]="opsTransaction.invoiceNo" #invoiceNo="ngModel">
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label class="form-control-label" for="">
                                                            Purchase Order No
                                                        </label>
                                                        <input type="text" class="form-control m-input m-input--square"
                                                            placeholder="Enter text" name="purchaseOrderNo"
                                                            [(ngModel)]="opsTransaction.purchaseOrderNo"
                                                            #purchaseOrderNo="ngModel">
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label class="form-control-label" for="">
                                                            Saleman
                                                        </label>
                                                        <app-combo-grid-virtual-scroll
                                                            [currentActiveItemId]="{field:'id',value:opsTransaction.salemanId}"
                                                            (itemSelected)="opsTransaction.salemanId = $event.id"
                                                            [selectedDisplayFields]="['employeeNameEn']"
                                                            [dataSources]="salemans"
                                                            [displayFields]="[{'field':'username','label':'User Name'},{'field':'employeeNameEn','label':'Full Name'},{'field':'','label':'Role'}]">
                                                        </app-combo-grid-virtual-scroll>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label class="form-control-label" for="">
                                                            Field OPS
                                                        </label>
                                                        <app-combo-grid-virtual-scroll
                                                            [currentActiveItemId]="{field:'id',value:opsTransaction.fieldOpsId}"
                                                            (itemSelected)="opsTransaction.fieldOpsId = $event.id"
                                                            [selectedDisplayFields]="['employeeNameEn']"
                                                            [dataSources]="billingOps"
                                                            [displayFields]="[{'field':'username','label':'User Name'},{'field':'employeeNameEn','label':'Full Name'},{'field':'','label':'Role'}]">
                                                        </app-combo-grid-virtual-scroll>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group"
                                                        [ngClass]="{'m-form__group has-danger':addOpsForm.submitted && opsTransaction.billingOpsId == null}">
                                                        <label class="form-control-label" for="">
                                                            Billing OPS <span class="m--font-danger">(*)</span>
                                                        </label>
                                                        <app-combo-grid-virtual-scroll
                                                            [currentActiveItemId]="{field:'id',value:opsTransaction.billingOpsId}"
                                                            (itemSelected)="opsTransaction.billingOpsId = $event.id"
                                                            [selectedDisplayFields]="['employeeNameEn']"
                                                            [dataSources]="billingOps"
                                                            [displayFields]="[{'field':'username','label':'User Name'},{'field':'employeeNameEn','label':'Full Name'},{'field':'','label':'Role'}]">
                                                        </app-combo-grid-virtual-scroll>
                                                        <div class="form-control-feedback" style="display: none">
                                                            Billing OPS is required!
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-4 m--margin-top-10 m--margin-bottom-5">
                                                    <span class="m--font-bolder">Create:</span>
                                                    <span
                                                        class="m--font-brand m--margin-left-5">{{ opsTransaction.createdDate | date : "dd/MM/yyyy HH:mm:ss" }}</span>
                                                    <span class="m--font-bolder m--margin-left-5">by</span>
                                                    <span
                                                        class="m--font-brand m--margin-left-5">{{ opsTransaction.userCreated }}</span>
                                                </div>
                                                <div class="col-md-4 m--margin-top-10 m--margin-bottom-5">
                                                    <span class="m--font-bolder">Modified:</span>
                                                    <span
                                                        class="m--font-brand m--margin-left-5">{{ opsTransaction.modifiedDate | date : "dd/MM/yyyy HH:mm:ss" }}</span>
                                                    <span class="m--font-bolder m--margin-left-5">by</span>
                                                    <span
                                                        class="m--font-brand m--margin-left-5">{{ opsTransaction.userModified }}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <!--end:: General Information -->
                                        <!--begin:: Good Information -->
                                        <div class="div-inside bg-secondary">
                                            <h3 class="c-block-title">Good Information</h3>
                                            <hr>
                                            <div class="row">
                                                <div class="col-lg-4">
                                                    <div class="form-group"
                                                        [ngClass]="{'m-form__group has-danger':addOpsForm.submitted && opsTransaction.sumGrossWeight == 0}">
                                                        <label class="form-control-label" for="">
                                                            GW
                                                        </label>
                                                        <input type="number" autocomplete="nope"
                                                            class="form-control m-input m-input--square"
                                                            placeholder="Enter number" name="sumGrossWeight"
                                                            [(ngModel)]="opsTransaction.sumGrossWeight" min="0.01"
                                                            decimalNumberGreaterThan0 #sumGrossWeight="ngModel">
                                                        <div class="form-control-feedback"
                                                            *ngIf="addOpsForm.submitted && opsTransaction.sumGrossWeight == 0">
                                                            Sum of gross weight must be greater than 0
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group"
                                                        [ngClass]="{'m-form__group has-danger':addOpsForm.submitted && opsTransaction.sumNetWeight == 0}">
                                                        <label class="form-control-label" for="">
                                                            NW
                                                        </label>
                                                        <input type="number" autocomplete="nope"
                                                            class="form-control m-input m-input--square"
                                                            placeholder="Enter number" name="sumNetWeight" min="0.01"
                                                            [(ngModel)]="opsTransaction.sumNetWeight"
                                                            decimalNumberGreaterThan0 #sumNetWeight="ngModel">
                                                        <div class="form-control-feedback"
                                                            *ngIf="addOpsForm.submitted && opsTransaction.sumNetWeight == 0">
                                                            Sum of net weight must be greater than 0
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group"
                                                        [ngClass]="{'m-form__group has-danger':addOpsForm.submitted && opsTransaction.sumCbm == 0}">
                                                        <label class="form-control-label" for="">
                                                            CBM
                                                        </label>
                                                        <input type="number" autocomplete="nope"
                                                            class="form-control m-input m-input--square" min="0.01"
                                                            placeholder="Enter number" name="sumCbm"
                                                            [(ngModel)]="opsTransaction.sumCbm"
                                                            decimalNumberGreaterThan0 #sumCbm="ngModel">
                                                        <div class="form-control-feedback"
                                                            *ngIf="addOpsForm.submitted && opsTransaction.sumCbm == 0">
                                                            Sum of CBM must be greater than 0
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-xl-4">
                                                    <div class="form-group"
                                                        [ngClass]="{'m-form__group has-danger':addOpsForm.submitted && opsTransaction.sumPackages == 0}">
                                                        <label class="form-control-label" for="">
                                                            Packages Qty
                                                        </label>
                                                        <div class="input-group m-input-group m-input-group--square">
                                                            <input type="number" class="form-control m-input" min="1"
                                                                autocomplete="nope" aria-label="" name="sumPackages"
                                                                appIntergerInputCheck placeholder="Enter number"
                                                                [(ngModel)]="opsTransaction.sumPackages"
                                                                #sumPackages="ngModel">
                                                            <div class="input-group-prepend">
                                                                <ng-select [allowClear]="false" [items]="packageTypes"
                                                                    [active]="packagesUnitActive" [disabled]="disabled"
                                                                    (data)="refreshValue($event)"
                                                                    (selected)="opsTransaction.packageTypeId = $event.id"
                                                                    (removed)="opsTransaction.packageTypeId = null"
                                                                    (typed)="typed($event)" placeholder="">
                                                                </ng-select>
                                                            </div>
                                                        </div>

                                                        <div class="form-control-feedback"
                                                            *ngIf="addOpsForm.submitted && opsTransaction.sumPackages == 0">
                                                            Packages Qty must be greater than 0
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-xl-4">
                                                    <div class="form-group"
                                                        [ngClass]="{'m-form__group has-danger':addOpsForm.submitted && opsTransaction.sumContainers == 0}">
                                                        <label class="form-control-label" for="">
                                                            Container Qty
                                                        </label>
                                                        <input type="number"
                                                            class="form-control m-input m-input--square" min="1"
                                                            appIntergerInputCheck name="sumContainers"
                                                            placeholder="Enter number"
                                                            [(ngModel)]="opsTransaction.sumContainers"
                                                            #sumContainers="ngModel">
                                                        <div class="form-control-feedback"
                                                            *ngIf="addOpsForm.submitted && opsTransaction.sumContainers == 0">
                                                            Container Qty must be greater than 0
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-xl-4">
                                                    <div class="m--margin-bottom-15 m--margin-top-25">
                                                        <button type="button"
                                                            class="btn btn-success m-btn--square m-btn--icon m-btn--uppercase"
                                                            (click)="showListContainer()">
                                                            <span>
                                                                <i class="la la-list"></i>
                                                                <span>
                                                                    Container list
                                                                </span>
                                                            </span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!--end:: Good Information-->
                                    </div>
                                </div>
                                <!--end::m-portlet -->
                            </div>
                        </form>
                        <!--end::Form-->

                        <div class="row">
                            <div class="col-12">
                                <ul class="nav nav-tabs m-tabs m-tabs-line m-tabs-line--brand m-tabs-line-danger"
                                    role="tablist">
                                    <li class="nav-item m-tabs__item">
                                        <a class="nav-link m-tabs__link active" data-toggle="tab" href="#buying-rate"
                                            role="tab">
                                            Buying Rate
                                        </a>
                                    </li>
                                    <li class="nav-item m-tabs__item">
                                        <a class="nav-link m-tabs__link" data-toggle="tab" href="#selling-rate"
                                            role="tab">
                                            Selling Rate
                                        </a>
                                    </li>
                                    <li class="nav-item m-tabs__item">
                                        <a class="nav-link m-tabs__link" data-toggle="tab" href="#obh-charge"
                                            role="tab">
                                            OBH
                                        </a>
                                    </li>
                                    <li class="nav-item m-tabs__item">
                                        <a class="nav-link m-tabs__link" data-toggle="tab" href="#logistic-charge"
                                            role="tab">
                                            Logistic Charges
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!--begin:: m-portlet-->
                        <div class="m-portlet">
                            <div class="m-portlet__body">
                                <div class="tab-content" id="">
                                    <!--begin::buying-rate-->
                                    <div class="tab-pane fade show active" id="buying-rate" role="tabpanel">
                                        <!--begin: Search Form -->
                                        <div class="m-form m-form--label-align-right m--margin-bottom-10">
                                            <div class="row align-items-center">
                                                <div class="col-lg-4 order-2 order-lg-1">
                                                    <div class="form-group">
                                                        <div class="m-input-icon m-input-icon--left">
                                                            <input type="text"
                                                                class="form-control m-input m-input--square"
                                                                placeholder="Search..."
                                                                (keyup)="ListBuyingRateCharges = searchCharge($event.target.value,'BUY')">
                                                            <span class="m-input-icon__icon m-input-icon__icon--left">
                                                                <span>
                                                                    <i class="la la-search"></i>
                                                                </span>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div
                                                    class="col-lg-8 order-1 order-lg-2 c-button-actions m--align-right">
                                                    <!-- <button type="button"
                                                        class="btn btn-success m-btn--square m-btn--icon m-btn--uppercase"
                                                        data-toggle="modal" data-target="#ops-add-buying-rate-modal">
                                                        <span>
                                                            <i class="la la-plus"></i>
                                                            <span>
                                                                add charge
                                                            </span>
                                                        </span>
                                                    </button> -->
                                                    <button type="button"
                                                        class="btn btn-success m-btn--square m-btn--icon m-btn--uppercase"
                                                        (click)="openAddNewBuyingRatePopup()">
                                                        <span>
                                                            <i class="la la-plus"></i>
                                                            <span>
                                                                add charge
                                                            </span>
                                                        </span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <!--end: Search Form -->
                                        <!--begin: Datatable-->
                                        <div class="table-wrapper table-scrollable fit-height-div-15" id="">
                                            <table class="table table-striped table-brand dataTable">
                                                <thead class="">
                                                    <tr class="">
                                                        <th class=""></th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'partnerName'), 'sorting_desc': (!isDesc && sortKey == 'partnerName') }"
                                                            (click)="sortBuyingRateCharges('partnerName')">
                                                            <span>
                                                                Partner
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'nameEn'), 'sorting_desc': (!isDesc && sortKey == 'nameEn') }"
                                                            (click)="sortBuyingRateCharges('nameEn')">
                                                            <span>
                                                                Name EN
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'quantity'), 'sorting_desc': (!isDesc && sortKey == 'quantity') }"
                                                            (click)="sortBuyingRateCharges('quantity')">
                                                            <span>
                                                                Quantity
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'unit'), 'sorting_desc': (!isDesc && sortKey == 'unit') }"
                                                            (click)="sortBuyingRateCharges('unit')">
                                                            <span>
                                                                Unit
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'unitPrice'), 'sorting_desc': (!isDesc && sortKey == 'unitPrice') }"
                                                            (click)="sortBuyingRateCharges('unitPrice')">
                                                            <span>
                                                                Unit price
                                                            </span>
                                                        </th>

                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'currency'), 'sorting_desc': (!isDesc && sortKey == 'currency') }"
                                                            (click)="sortBuyingRateCharges('currency')">
                                                            <span>
                                                                Currency
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'vatrate'), 'sorting_desc': (!isDesc && sortKey == 'vatrate') }"
                                                            (click)="sortBuyingRateCharges('vatrate')">
                                                            <span>
                                                                VAT
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'total'), 'sorting_desc': (!isDesc && sortKey == 'total') }"
                                                            (click)="sortBuyingRateCharges('total')">
                                                            <span>
                                                                Total
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'notes'), 'sorting_desc': (!isDesc && sortKey == 'notes') }"
                                                            (click)="sortBuyingRateCharges('notes')">
                                                            <span>
                                                                Note
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'docNo'), 'sorting_desc': (!isDesc && sortKey == 'docNo') }"
                                                            (click)="sortBuyingRateCharges('docNo')">
                                                            <span>
                                                                Docs
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'soano'), 'sorting_desc': (!isDesc && sortKey == 'soano') }"
                                                            (click)="sortBuyingRateCharges('soano')">
                                                            <span>
                                                                SOA
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'cdno'), 'sorting_desc': (!isDesc && sortKey == 'cdno') }"
                                                            (click)="sortBuyingRateCharges('cdno')">
                                                            <span>
                                                                Credit/ Debit note
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'settlementCode'), 'sorting_desc': (!isDesc && sortKey == 'settlementCode') }"
                                                            (click)="sortBuyingRateCharges('settlementCode')">
                                                            <span>
                                                                Settle payment
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'exchangeDate'), 'sorting_desc': (!isDesc && sortKey == 'exchangeDate') }"
                                                            (click)="sortBuyingRateCharges('exchangeDate')">
                                                            <span>
                                                                Exchange rate date
                                                            </span>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class=""
                                                        *ngFor="let charge of ListBuyingRateCharges;let i = index;">
                                                        <td class="table-actions-col">
                                                            <div class="table-actions" style="width: 70px">
                                                                <!-- <button type="button"
                                                                    (click)="prepareEditCharge('BUY',charge)"
                                                                    class="btn btn-success btn-sm m-btn--square m-btn--icon m-btn--icon-only"
                                                                    title="Edit" data-toggle="modal"
                                                                    data-target="#ops-edit-buying-rate-modal">
                                                                    <i class="la la-edit"></i>
                                                                </button> -->
                                                                <button type="button"
                                                                    (click)="prepareEditCharge('BUY',charge)"
                                                                    class="btn btn-success btn-sm m-btn--square m-btn--icon m-btn--icon-only"
                                                                    title="Edit">
                                                                    <i class="la la-edit"></i>
                                                                </button>
                                                                <!-- <button type="button"
                                                                    (click)="DeleteCharge('confirm',charge.id)"
                                                                    class="btn btn-danger btn-sm m-btn--square m-btn--icon m-btn--icon-only"
                                                                    title="Remove" data-toggle="modal"
                                                                    data-target="#ops-confirm-delete-charge-modal">
                                                                    <i class="la la-trash"></i>
                                                                </button> -->
                                                                <button type="button"
                                                                    (click)="showConfirmDeleteCharge(charge.id)"
                                                                    class="btn btn-danger btn-sm m-btn--square m-btn--icon m-btn--icon-only"
                                                                    title="Remove">
                                                                    <i class="la la-trash"></i>
                                                                </button>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.partnerName}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <!-- <span>
				{{charge.nameEn}}
			</span> -->
                                                            <!-- <a href="javascript:void()"
                                                                (click)="prepareEditCharge('BUY',charge)"
                                                                data-toggle="modal"
                                                                data-target="#ops-edit-buying-rate-modal">{{charge.nameEn}}</a> -->
                                                            <a href="javascript:void(0)"
                                                                (click)="prepareEditCharge('BUY',charge)">{{charge.nameEn}}</a>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.quantity}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.unit}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.unitPrice | number : '1.3-3'}}
                                                            </span>
                                                        </td>

                                                        <td>
                                                            <span>
                                                                {{charge.currency}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.vatrate}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.total | number : '1.3-3'}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.notes}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.docNo}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.soano}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <!-- <a href="javascript:void(0)" data-toggle="modal"
							data-target="#detail-credit-debit-note-modal"
							(click)="openCreditDebitNote(charge.cdno)">
							{{ charge.cdno }}
						</a> -->
                                                            <a href="javascript:void(0)"
                                                                (click)="openCreditDebitNote(charge.creditNo)">
                                                                {{ charge.creditNo }}
                                                            </a>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                <!-- Settle payment -->
                                                                {{ charge.settlementCode }}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.exchangeDate | date:'dd/MM/yyyy'}}
                                                            </span>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <!--end: Datatable-->
                                    </div>
                                    <!--end::buying-rate-->

                                    <!--begin::selling-rate-->
                                    <div class="tab-pane fade" id="selling-rate" role="tabpanel">
                                        <!--begin: Search Form -->
                                        <div class="m-form m-form--label-align-right m--margin-bottom-10">
                                            <div class="row align-items-center">
                                                <div class="col-lg-4 order-2 order-lg-1">
                                                    <div class="form-group">
                                                        <div class="m-input-icon m-input-icon--left">
                                                            <input type="text"
                                                                class="form-control m-input m-input--square"
                                                                placeholder="Search..."
                                                                (keyup)="ListSellingRateCharges = searchCharge($event.target.value,'SELL')">
                                                            <span class="m-input-icon__icon m-input-icon__icon--left">
                                                                <span>
                                                                    <i class="la la-search"></i>
                                                                </span>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div
                                                    class="col-lg-8 order-1 order-lg-2 c-button-actions m--align-right">
                                                    <!-- <button type="button"
                                                        class="btn btn-success m-btn--square m-btn--icon m-btn--uppercase"
                                                        data-toggle="modal" data-target="#ops-add-selling-rate-modal">
                                                        <span>
                                                            <i class="la la-plus"></i>
                                                            <span>
                                                                add charge
                                                            </span>
                                                        </span>
                                                    </button> -->
                                                    <button type="button"
                                                        class="btn btn-success m-btn--square m-btn--icon m-btn--uppercase"
                                                        (click)="openAddNewSellingRatePopup()">
                                                        <span>
                                                            <i class="la la-plus"></i>
                                                            <span>
                                                                add charge
                                                            </span>
                                                        </span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <!--end: Search Form -->
                                        <!--begin: Datatable-->
                                        <div class="table-wrapper table-scrollable fit-height-div-15" id="">
                                            <table class="table table-striped table-brand dataTable">
                                                <thead class="">
                                                    <tr class="">
                                                        <th class=""></th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'partnerName'), 'sorting_desc': (!isDesc && sortKey == 'partnerName') }"
                                                            (click)="sortSellingRateCharges('partnerName')">
                                                            <span>
                                                                Partner
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'nameEn'), 'sorting_desc': (!isDesc && sortKey == 'nameEn') }"
                                                            (click)="sortSellingRateCharges('nameEn')">
                                                            <span>
                                                                Name EN
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'quantity'), 'sorting_desc': (!isDesc && sortKey == 'quantity') }"
                                                            (click)="sortSellingRateCharges('quantity')">
                                                            <span>
                                                                Quantity
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'unit'), 'sorting_desc': (!isDesc && sortKey == 'unit') }"
                                                            (click)="sortSellingRateCharges('unit')">
                                                            <span>
                                                                Unit
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'unitPrice'), 'sorting_desc': (!isDesc && sortKey == 'unitPrice') }"
                                                            (click)="sortSellingRateCharges('unitPrice')">
                                                            <span>
                                                                Unit Price
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'currency'), 'sorting_desc': (!isDesc && sortKey == 'currency') }"
                                                            (click)="sortSellingRateCharges('currency')">
                                                            <span>
                                                                Currency
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'vatrate'), 'sorting_desc': (!isDesc && sortKey == 'vatrate') }"
                                                            (click)="sortSellingRateCharges('vatrate')">
                                                            <span>
                                                                VAT
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'total'), 'sorting_desc': (!isDesc && sortKey == 'total') }"
                                                            (click)="sortSellingRateCharges('total')">
                                                            <span>
                                                                Total
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'notes'), 'sorting_desc': (!isDesc && sortKey == 'notes') }"
                                                            (click)="sortSellingRateCharges('notes')">
                                                            <span>
                                                                Note
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'docNo'), 'sorting_desc': (!isDesc && sortKey == 'docNo') }"
                                                            (click)="sortSellingRateCharges('docNo')">
                                                            <span>
                                                                Docs
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'soano'), 'sorting_desc': (!isDesc && sortKey == 'soano') }"
                                                            (click)="sortSellingRateCharges('soano')">
                                                            <span>
                                                                SOA
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'cdno'), 'sorting_desc': (!isDesc && sortKey == 'cdno') }"
                                                            (click)="sortSellingRateCharges('cdno')">
                                                            <span>
                                                                Credit/ Debit note
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'settlementCode'), 'sorting_desc': (!isDesc && sortKey == 'settlementCode') }"
                                                            (click)="sortSellingRateCharges('settlementCode')">
                                                            <span>
                                                                Settle payment
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'exchangeDate'), 'sorting_desc': (!isDesc && sortKey == 'exchangeDate') }"
                                                            (click)="sortSellingRateCharges('exchangeDate')">
                                                            <span>
                                                                Exchange rate date
                                                            </span>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class=""
                                                        *ngFor="let charge of ListSellingRateCharges;let i = index;">
                                                        <td class="table-actions-col">
                                                            <div class="table-actions" style="width: 70px">
                                                                <!-- <button type="button"
                                                                    (click)="prepareEditCharge('SELL',charge)"
                                                                    class="btn btn-success btn-sm m-btn--square m-btn--icon m-btn--icon-only"
                                                                    title="Edit" data-toggle="modal"
                                                                    data-target="#ops-edit-selling-rate-modal">
                                                                    <i class="la la-edit"></i>
                                                                </button> -->
                                                                <button type="button"
                                                                    (click)="prepareEditCharge('SELL',charge)"
                                                                    class="btn btn-success btn-sm m-btn--square m-btn--icon m-btn--icon-only"
                                                                    title="Edit">
                                                                    <i class="la la-edit"></i>
                                                                </button>
                                                                <!-- <button type="button"
                                                                    (click)="DeleteCharge('confirm',charge.id)"
                                                                    class="btn btn-danger btn-sm m-btn--square m-btn--icon m-btn--icon-only"
                                                                    title="Remove" data-toggle="modal"
                                                                    data-target="#ops-confirm-delete-charge-modal">
                                                                    <i class="la la-trash"></i>
                                                                </button> -->
                                                                <button type="button"
                                                                    (click)="showConfirmDeleteCharge(charge.id)"
                                                                    class="btn btn-danger btn-sm m-btn--square m-btn--icon m-btn--icon-only"
                                                                    title="Remove">
                                                                    <i class="la la-trash"></i>
                                                                </button>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.partnerName}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <!-- <a href="javascript:void()"
                                                                (click)="prepareEditCharge('SELL',charge)"
                                                                data-toggle="modal"
                                                                data-target="#ops-edit-selling-rate-modal">{{charge.nameEn}}</a> -->
                                                            <a href="javascript:void(0)"
                                                                (click)="prepareEditCharge('SELL',charge)">{{charge.nameEn}}</a>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.quantity}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.unit}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.unitPrice | number : '1.3-3'}}
                                                            </span>
                                                        </td>

                                                        <td>
                                                            <span>
                                                                {{charge.currency}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.vatrate}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.total | number : '1.3-3'}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.notes}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.docNo}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.soano}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <!-- <a href="javascript:void(0)" data-toggle="modal"
                                                                data-target="#detail-credit-debit-note-modal"
                                                                (click)="openCreditDebitNote()">
                                                                {{ charge.cdno }}
                                                            </a> -->
                                                            <a href="javascript:void(0)"
                                                                (click)="openCreditDebitNote(charge.debitNo)">
                                                                {{ charge.debitNo }}
                                                            </a>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                <!-- Settle payment -->
                                                                {{ charge.settlementCode }}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.exchangeDate | date:'dd/MM/yyyy'}}
                                                            </span>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <!--end: Datatable-->
                                    </div>
                                    <!--end::selling-rate-->

                                    <!--begin::obh-charge-->
                                    <div class="tab-pane fade" id="obh-charge" role="tabpanel">
                                        <!--begin: Search Form -->
                                        <div class="m-form m-form--label-align-right m--margin-bottom-10">
                                            <div class="row align-items-center">
                                                <div class="col-lg-6 order-2 order-lg-1">
                                                    <div class="form-group">
                                                        <div class="m-input-icon m-input-icon--left">
                                                            <input type="text"
                                                                class="form-control m-input m-input--square"
                                                                placeholder="Search..."
                                                                (keyup)="ListOBHCharges=searchCharge($event.target.value,'OBH')">
                                                            <span class="m-input-icon__icon m-input-icon__icon--left">
                                                                <span>
                                                                    <i class="la la-search"></i>
                                                                </span>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div
                                                    class="col-lg-6 order-1 order-lg-2 c-button-actions m--align-right">
                                                    <!-- <button type="button"
                                                        class="btn btn-success m-btn--square m-btn--icon m-btn--uppercase"
                                                        data-toggle="modal" data-target="#ops-add-obh-charge-modal">
                                                        <span>
                                                            <i class="la la-plus"></i>
                                                            <span>
                                                                add charge
                                                            </span>
                                                        </span>
                                                    </button> -->
                                                    <button type="button"
                                                        class="btn btn-success m-btn--square m-btn--icon m-btn--uppercase"
                                                        (click)="openAddNewOBHRatePopup()">
                                                        <span>
                                                            <i class="la la-plus"></i>
                                                            <span>
                                                                add charge
                                                            </span>
                                                        </span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <!--end: Search Form -->
                                        <!--begin: Datatable-->
                                        <div class="table-wrapper table-scrollable fit-height-div-15" id="">
                                            <table class="table table-striped table-brand dataTable">
                                                <thead class="">
                                                    <tr class="">
                                                        <th class=""></th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'receiverName'), 'sorting_desc': (!isDesc && sortKey == 'receiverName') }"
                                                            (click)="sortOBHRateCharges('receiverName')">
                                                            <span>
                                                                Receiver
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'payerName'), 'sorting_desc': (!isDesc && sortKey == 'payerName') }"
                                                            (click)="sortOBHRateCharges('payerName')">
                                                            <span>
                                                                Payer
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'nameEn'), 'sorting_desc': (!isDesc && sortKey == 'nameEn') }"
                                                            (click)="sortOBHRateCharges('nameEn')">
                                                            <span>
                                                                Name EN
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'quantity'), 'sorting_desc': (!isDesc && sortKey == 'quantity') }"
                                                            (click)="sortOBHRateCharges('quantity')">
                                                            <span>
                                                                Quantity
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'unit'), 'sorting_desc': (!isDesc && sortKey == 'unit') }"
                                                            (click)="sortOBHRateCharges('unit')">
                                                            <span>
                                                                Unit
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'unitPrice'), 'sorting_desc': (!isDesc && sortKey == 'unitPrice') }"
                                                            (click)="sortOBHRateCharges('unitPrice')">
                                                            <span>
                                                                Unit price
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'currency'), 'sorting_desc': (!isDesc && sortKey == 'currency') }"
                                                            (click)="sortOBHRateCharges('currency')">
                                                            <span>
                                                                Currency
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'vatrate'), 'sorting_desc': (!isDesc && sortKey == 'vatrate') }"
                                                            (click)="sortOBHRateCharges('vatrate')">
                                                            <span>
                                                                VAT
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'total'), 'sorting_desc': (!isDesc && sortKey == 'total') }"
                                                            (click)="sortOBHRateCharges('total')">
                                                            <span>
                                                                Total
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'notes'), 'sorting_desc': (!isDesc && sortKey == 'notes') }"
                                                            (click)="sortOBHRateCharges('notes')">
                                                            <span>
                                                                Note
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'docNo'), 'sorting_desc': (!isDesc && sortKey == 'docNo') }"
                                                            (click)="sortOBHRateCharges('docNo')">
                                                            <span>
                                                                Docs
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'soano'), 'sorting_desc': (!isDesc && sortKey == 'soano') }"
                                                            (click)="sortOBHRateCharges('soano')">
                                                            <span>
                                                                SOA
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'cdno'), 'sorting_desc': (!isDesc && sortKey == 'cdno') }"
                                                            (click)="sortOBHRateCharges('cdno')">
                                                            <span>
                                                                Credit/ Debit note
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'settlementCode'), 'sorting_desc': (!isDesc && sortKey == 'settlementCode') }"
                                                            (click)="sortOBHRateCharges('settlementCode')">
                                                            <span>
                                                                Settle payment
                                                            </span>
                                                        </th>
                                                        <th class="sorting"
                                                            [ngClass]="{ 'sorting_asc ': (isDesc && sortKey == 'exchangeDate'), 'sorting_desc': (!isDesc && sortKey == 'exchangeDate') }"
                                                            (click)="sortOBHRateCharges('exchangeDate')">
                                                            <span>
                                                                Exchange rate date
                                                            </span>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="" *ngFor="let charge of ListOBHCharges;let i = index;">
                                                        <td class="table-actions-col">
                                                            <div class="table-actions" style="width: 70px">
                                                                <!-- <button type="button"
                                                                    (click)="prepareEditCharge('OBH',charge)"
                                                                    class="btn btn-success btn-sm m-btn--square m-btn--icon m-btn--icon-only"
                                                                    title="Edit" data-toggle="modal"
                                                                    data-target="#ops-edit-obh-charge-modal">
                                                                    <i class="la la-edit"></i>
                                                                </button> -->
                                                                <button type="button"
                                                                    (click)="prepareEditCharge('OBH',charge)"
                                                                    class="btn btn-success btn-sm m-btn--square m-btn--icon m-btn--icon-only"
                                                                    title="Edit">
                                                                    <i class="la la-edit"></i>
                                                                </button>
                                                                <button type="button"
                                                                    (click)="showConfirmDeleteCharge(charge.id)"
                                                                    class="btn btn-danger btn-sm m-btn--square m-btn--icon m-btn--icon-only"
                                                                    title="Remove">
                                                                    <i class="la la-trash"></i>
                                                                </button>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.receiverName}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.payerName}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <!-- <a href="javascript:void()"
                                                                (click)="prepareEditCharge('OBH',charge)"
                                                                data-toggle="modal"
                                                                data-target="#ops-edit-obh-charge-modal">{{charge.nameEn}}</a> -->
                                                            <a href="javascript:void()"
                                                                (click)="prepareEditCharge('OBH',charge)">{{charge.nameEn}}</a>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.quantity}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.unit}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.unitPrice | number : '1.3-3'}}
                                                            </span>
                                                        </td>

                                                        <td>
                                                            <span>
                                                                {{charge.currency}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.vatrate}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.total | number : '1.3-3'}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.notes}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.docNo}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.soano}}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <!-- <a href="javascript:void(0)" data-toggle="modal"
                                                                data-target="#detail-credit-debit-note-modal">
                                                                {{ charge.cdno }}
                                                            </a> -->
                                                            <a href="javascript:void(0)"
                                                                (click)="openCreditDebitNote(charge.creditNo)"
                                                                *ngIf="charge.creditNo">
                                                                {{ charge.creditNo }}
                                                            </a>
                                                            <a *ngIf="charge.creditNo === null">__ </a> /
                                                            <a href="javascript:void(0)"
                                                                (click)="openCreditDebitNote(charge.debitNo)"
                                                                *ngIf="charge.debitNo">
                                                                {{ charge.debitNo }}
                                                            </a>
                                                            <a *ngIf="charge.debitNo === null"> __</a>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                <!-- Settle payment -->
                                                                {{ charge.settlementCode }}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                {{charge.exchangeDate | date:'dd/MM/yyyy'}}
                                                            </span>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <!--end: Datatable-->
                                    </div>
                                    <!--end::obh-charge-->

                                    <!--begin::logistic-charge-->
                                    <div class="tab-pane fade" id="logistic-charge" role="tabpanel">
                                        <!--begin: Search Form -->
                                        <div class="m-form m-form--label-align-right m--margin-bottom-10">
                                            <div class="row align-items-center">
                                                <div class="col-lg-6 order-2 order-lg-1">
                                                    <div class="form-group">
                                                        <div class="m-input-icon m-input-icon--left">
                                                            <input type="text"
                                                                class="form-control m-input m-input--square"
                                                                placeholder="Search...">
                                                            <span class="m-input-icon__icon m-input-icon__icon--left">
                                                                <span>
                                                                    <i class="la la-search"></i>
                                                                </span>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!--end: Search Form -->
                                        <!--begin: Datatable-->
                                        <div class="table-wrapper table-scrollable fit-height-div-15" id="">
                                            <table class="table table-striped table-brand dataTable">
                                                <thead class="">
                                                    <tr class="">
                                                        <th class="sorting">
                                                            <span>
                                                                Partner
                                                            </span>
                                                        </th>
                                                        <th class="sorting">
                                                            <span>
                                                                Name EN
                                                            </span>
                                                        </th>
                                                        <th class="sorting">
                                                            <span>
                                                                Quantity
                                                            </span>
                                                        </th>
                                                        <th class="sorting">
                                                            <span>
                                                                Unit
                                                            </span>
                                                        </th>
                                                        <th class="sorting">
                                                            <span>
                                                                Unit price
                                                            </span>
                                                        </th>

                                                        <th class="sorting">
                                                            <span>
                                                                Currency
                                                            </span>
                                                        </th>
                                                        <th class="">
                                                            <span>
                                                                VAT
                                                            </span>
                                                        </th>
                                                        <th class="">
                                                            <span>
                                                                Total
                                                            </span>
                                                        </th>
                                                        <th class="">
                                                            <span>
                                                                Note
                                                            </span>
                                                        </th>
                                                        <th class="">
                                                            <span>
                                                                Docs
                                                            </span>
                                                        </th>
                                                        <th class="sorting">
                                                            <span>
                                                                SOA
                                                            </span>
                                                        </th>
                                                        <th class="sorting">
                                                            <span>
                                                                Credit/ Debit note
                                                            </span>
                                                        </th>
                                                        <th class="sorting">
                                                            <span>
                                                                Settle payment
                                                            </span>
                                                        </th>
                                                        <th class="sorting">
                                                            <span>
                                                                Exchange rate date
                                                            </span>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="">
                                                        <td>
                                                            <span>
                                                                Partner
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                Name EN
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                Quantity
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                Unit
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                Unit price
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                Currency
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                VAT
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                Total
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                Note
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                Docs
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                SOA
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <!-- <a href="javascript:void(0)" data-toggle="modal"
                                                                data-target="#detail-credit-debit-note-modal">
                                                                Credit/ Debit note
                                                            </a> -->
                                                        </td>
                                                        <td>
                                                            <span>
                                                                Settle payment
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span>
                                                                Exchange rate date
                                                            </span>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <!--end: Datatable-->
                                    </div>
                                    <!--end::logistic-charge-->
                                </div>
                            </div>
                        </div>
                        <!--end:: m-portlet-->

                        <!--begin:: m-portlet-->
                        <div class="m-portlet m-portlet--danger m-portlet--head-solid-bg m-portlet--bordered">
                            <div class="alert-block__heading">
                                <h3 class="alert-block__title collapse-toggle" data-toggle="collapse"
                                    data-target="#profit-summary">
                                    <i class="la la-angle-up m--margin-right-5"></i> Profit summary
                                </h3>
                            </div>
                            <div class="m-portlet__body">
                                <div class="collapse show" id="profit-summary">
                                    <!--begin: table -->
                                    <div class="table-wrapper" id="">
                                        <table class="table table-striped table-brand">
                                            <thead>
                                                <tr>
                                                    <th>Type</th>
                                                    <th>
                                                        <span>USD</span>
                                                    </th>
                                                    <th>
                                                        <span>Local (VNĐ)</span>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>
                                                        <span>Buying rate</span>
                                                    </td>
                                                    <td>
                                                        <span>{{totalBuyingUSD | number : '1.3-3'}}</span>
                                                    </td>
                                                    <td>
                                                        <span>{{totalBuyingLocal | number : '1.3-3'}}</span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <span>Selling rate</span>
                                                    </td>
                                                    <td>
                                                        <span>{{totalSellingUSD | number : '1.3-3'}}</span>
                                                    </td>
                                                    <td>
                                                        <span>{{totalSellingLocal | number : '1.3-3'}}</span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <span>OBH</span>
                                                    </td>
                                                    <td>
                                                        <span>{{totalOBHUSD | number : '1.3-3'}}</span>
                                                    </td>
                                                    <td>
                                                        <span>{{totalOBHLocal | number : '1.3-3'}}</span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <span>Logictis charge</span>
                                                    </td>
                                                    <td>
                                                        <span>{{totalLogisticChargeUSD | number : '1.3-3'}}</span>
                                                    </td>
                                                    <td>
                                                        <span>{{totalLogisticChargeLocal | number : '1.3-3'}}</span>
                                                    </td>
                                                </tr>
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    <th>
                                                        <span>Total</span>
                                                    </th>
                                                    <th>
                                                        <span>{{totalProfitUSD | number : '1.3-3'}}</span>
                                                    </th>
                                                    <th>
                                                        <span>{{totalProfitLocal | number : '1.3-3'}}</span>
                                                    </th>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                    <!--end: table -->
                                </div>
                            </div>
                        </div>
                        <!--end:: m-portlet-->
                    </div>
                </tab>
                <tab heading="Custom declaration" (selectTab)="selectTab($event,'custom-declaration')">
                    <app-billing-custom-declaration *ngIf="tab === 'custom-declaration'" [currentJob]="opsTransaction">
                    </app-billing-custom-declaration>
                </tab>
                <tab heading="Credit Note & Debit Note" (selectTab)="selectTab($event,'cre-debit-note')">
                    <app-ops-module-credit-debit-note *ngIf="tab === 'cre-debit-note'" [currentJob]="opsTransaction">
                    </app-ops-module-credit-debit-note>
                </tab>
                <tab heading="Stage management" [active]="tab === 'stage'" (selectTab)="selectTab($event, 'stage')">
                    <app-ops-module-stage-management *ngIf="tab === 'stage'" [data]="opsTransaction">
                    </app-ops-module-stage-management>
                </tab>
            </tabset>
        </div>
    </div>
</div>
<!--end:: m-content-->

<!--begin::container-list-of-ops-billing-modal-->
<app-container-list [jobId]="jobId" [lstMasterContainers]='lstMasterContainers'
    (outputContainers)="saveContainers($event)" *ngIf="jobId && lstMasterContainers"></app-container-list>
<!--end::container-list-of-ops-billing-modal-->

<!--begin:: add-buying-rate-modal-->
<app-add-buying-rate-popup [opsTransaction]="opsTransaction" *ngIf="opsTransaction"
    (outputAddBuying)="onSaveNewBuyingRate($event)"></app-add-buying-rate-popup>
<!--end:: add-buying-rate-modal-->

<!--begin:: edit-buying-rate-modal-->
<app-edit-buying-rate-popup [opsTransaction]="opsTransaction" [buyingRateChargeToEdit]="BuyingRateChargeToEdit"
    *ngIf="opsTransaction && BuyingRateChargeToEdit" (outputEditBuying)="onSaveBuyingRate($event)">
</app-edit-buying-rate-popup>
<!--end:: Edit-buying-rate-modal-->

<!--begin:: ops-add-selling-rate-modal-->
<app-add-selling-rate-popup [opsTransaction]="opsTransaction" *ngIf="opsTransaction"
    (outputAddSelling)="onSaveNewSellingRate($event)"></app-add-selling-rate-popup>
<!--end:: add-selling-rate-modal-->

<!--begin:: Edit-selling-rate-modal-->
<app-edit-selling-rate-popup [opsTransaction]="opsTransaction" [sellingRateChargeToEdit]="SellingRateChargeToEdit"
    *ngIf="opsTransaction && SellingRateChargeToEdit" (outputEditSelling)="onSaveSellingRate($event)">
</app-edit-selling-rate-popup>
<!--end:: Edit-selling-rate-modal-->

<!--begin:: add-obh-charge-modal-->
<app-add-obh-rate-popup [opsTransaction]="opsTransaction" *ngIf="opsTransaction"
    (outputAddOBH)="onSaveNewOBHRate($event)"></app-add-obh-rate-popup>
<!--end:: add-obh-charge-modal-->

<!--begin:: edit-obh-charge-modal-->
<app-edit-obh-rate-popup [opsTransaction]="opsTransaction" [obhChargeToEdit]="OBHChargeToEdit"
    *ngIf="opsTransaction && OBHChargeToEdit" (outputEditBuying)="onSaveOHBRate($event)">
</app-edit-obh-rate-popup>
<!--end:: Edit-obh-charge-modal-->

<!--begin::confirm-delete-charge-modal-->
<confirm-popup [title]="'Delete Charge'" [body]="'Are you sure want to delete this Charge?'"
    (onSubmit)="deleteCharge()"></confirm-popup>
<!--end::confirm-delete-charge-modal-->

<!--begin::cancel-create-ops-job-modal-->
<app-cancel-create-job-popup></app-cancel-create-job-popup>
<!--end::cancel-create-ops-job-modal-->


<!--begin::confirm-can-not-delete-job-modal-->
<app-can-not-delete-job-popup></app-can-not-delete-job-popup>
<!--end::confirm-can-not-delete-job-modal-->

<!--begin::confirm-delete-job-modal-->
<app-confirm-delete-job-popup (onSubmit)="deleteJob()" [jobNo]="opsTransaction.jobNo" *ngIf="opsTransaction">
</app-confirm-delete-job-popup>
<!--end::confirm-delete-job-modal-->

<!--begin::confirm-cancel-job-modal-->
<app-confirm-cancel-job-popup></app-confirm-cancel-job-popup>
<!--end::confirm-cancel-job-modal-->

<app-ops-module-credit-debit-note-detail [CDNoteDetails]="CDNoteDetails" (openEditCDNote)="openEditCDNotePopUp($event)">
</app-ops-module-credit-debit-note-detail>

<!-- <app-ops-module-credit-debit-note-edit [cdNoteDetails]="CDNoteDetails" (isCloseModal)="closeEditCDNoteModal($event)">
</app-ops-module-credit-debit-note-edit> -->

<pl-sheet-popup></pl-sheet-popup>